<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Virtual HealthCare — Local Prototype</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg1:#0d1421; --bg2:#0f1724; --card:rgba(255,255,255,0.03);
      --text:#e6eef8; --muted:#9aa6b2; --accent:#5b6bff; --accent-2:#29c29b; --glass:rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    body{min-height:100vh;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);padding:22px}

    .app{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:260px 1fr;gap:18px}

    header.app-header{grid-column:1/-1;display:flex;align-items:center;gap:18px;padding:14px;border-radius:12px;background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04)}
    .brand{display:flex;flex-direction:column}
    .brand-title{font-weight:800;font-size:1.2rem;background:linear-gradient(90deg,var(--accent-2),var(--accent));-webkit-background-clip:text;background-clip:text;color:transparent}
    .brand-sub{color:var(--muted);font-size:0.85rem}

    .header-actions{margin-left:auto;display:flex;gap:10px;align-items:center}
    .btn{background:linear-gradient(135deg,var(--accent),#7e6bff);border:none;color:white;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;display:inline-flex;gap:8px;align-items:center}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .btn:active{transform:translateY(1px)}

    /* Sidebar */
    .sidebar{background:var(--card);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);height:calc(100vh - 120px);overflow:auto}
    .profile{display:flex;gap:10px;align-items:center}
    .avatar{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700}
    .user-info{line-height:1}
    .user-name{font-weight:700}
    .user-role{color:var(--muted);font-size:0.85rem}

    .nav{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    .nav button{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;background:transparent;border:none;color:var(--text);text-align:left;cursor:pointer}
    .nav button.active{background:linear-gradient(90deg,rgba(91,107,255,0.12),rgba(41,194,155,0.06));border:1px solid rgba(255,255,255,0.02)}

    /* Main content area */
    .main-area{display:grid;grid-template-rows:auto 1fr;gap:12px}
    .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .card{background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}

    .doctor-list{display:flex;flex-direction:column;gap:10px}
    .doctor{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
    .doctor .meta{flex:1}
    .chip{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:0.85rem;color:var(--muted)}

    /* Booking form */
    .field{margin-top:8px}
    input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    label{font-weight:700;font-size:0.9rem;color:var(--muted)}

    .appointments{display:flex;flex-direction:column;gap:8px}
    .appt{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.01),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.02)}
    .muted{color:var(--muted);font-size:0.9rem}

    /* Medical history */
    .history-list{display:flex;flex-direction:column;gap:8px}
    .history-item{padding:10px;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}

    /* Video call */
    .video-stage{display:flex;gap:12px;align-items:flex-start}
    video{border-radius:10px;background:#000;max-width:100%}

    /* Symptom checker */
    .advice{padding:10px;border-radius:8px;background:linear-gradient(90deg,rgba(91,107,255,0.06),rgba(41,194,155,0.04));border:1px solid rgba(255,255,255,0.02);color:var(--text)}

    /* Responsive */
    @media(max-width:980px){
      .app{grid-template-columns:1fr;}
      .sidebar{height:auto}
      .cards{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="brand">
        <div class="brand-title">Virtual HealthCare</div>
        <div class="brand-sub">Book appointments • Telehealth • Personal medical history</div>
      </div>

      <div class="header-actions">
        <button id="exportHistory" class="btn"><i class="fa-solid fa-file-export"></i> Export History</button>
        <button id="helpBtn" class="btn ghost"><i class="fa-solid fa-circle-question"></i> Help</button>
      </div>
    </header>

    <aside class="sidebar">
      <div class="profile">
        <div class="avatar">VK</div>
        <div class="user-info">
          <div class="user-name">Patient</div>
          <div class="user-role">Local-first prototype</div>
        </div>
      </div>

      <nav class="nav" id="nav">
        <button class="active" data-view="dashboard"><i class="fa-solid fa-grid"></i> Dashboard</button>
        <button data-view="book"><i class="fa-solid fa-calendar-plus"></i> Book Appointment</button>
        <button data-view="history"><i class="fa-solid fa-folder-medical"></i> Medical History</button>
        <button data-view="telehealth"><i class="fa-solid fa-video"></i> Telehealth Call</button>
        <button data-view="support"><i class="fa-solid fa-hands-holding-medical"></i> Symptom Support</button>
      </nav>

      <hr style="margin-top:12px;border:none;border-top:1px solid rgba(255,255,255,0.04)">

      <div style="margin-top:12px">
        <div class="muted">Available doctors</div>
        <div class="doctor-list" id="doctorList"></div>
      </div>
    </aside>

    <main class="main-area">
      <div id="contentTop"></div>

      <div id="content" style="min-height:420px"></div>
    </main>
  </div>

  <script>
    // Local state storage keys
    const STORAGE_KEY = 'vhc_app_v1';

    // Default doctors
    const DOCTORS = [
      {id:'d1',name:'Dr. Maya Chen',specialty:'General Physician',avatar:'MC'},
      {id:'d2',name:'Dr. Arjun Patel',specialty:'Pediatrics',avatar:'AP'},
      {id:'d3',name:'Dr. Leila Gomez',specialty:'Psychiatry',avatar:'LG'}
    ];

    // Initialize state
    let appState = { appointments: [], history: [] };
    function load(){ const s = localStorage.getItem(STORAGE_KEY); if(s) appState = JSON.parse(s); }
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(appState)); }

    // Utilities
    function uid(){ return Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,8); }
    function fmtDateTime(d){ const dt = new Date(d); return dt.toLocaleString(); }

    // Render doctor list in sidebar
    const doctorListDiv = document.getElementById('doctorList');
    function renderDoctors(){ doctorListDiv.innerHTML='';
      DOCTORS.forEach(d=>{
        const el = document.createElement('div'); el.className='doctor';
        el.innerHTML = `<div class="avatar">${d.avatar}</div><div class="meta"><div style="font-weight:700">${d.name}</div><div class="muted">${d.specialty}</div></div><div><button class='btn ghost' data-doctor='${d.id}'>Book</button></div>`;
        doctorListDiv.appendChild(el);
      });
      // attach book buttons
      doctorListDiv.querySelectorAll('button').forEach(b=> b.addEventListener('click', ()=>{ showView('book'); preselectDoctor(b.dataset.doctor); }));
    }

    // Navigation
    document.getElementById('nav').addEventListener('click', (ev)=>{
      const btn = ev.target.closest('button'); if(!btn) return;
      document.querySelectorAll('#nav button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      showView(btn.dataset.view);
    });

    // Content rendering helpers
    const content = document.getElementById('content');
    const contentTop = document.getElementById('contentTop');

    function showView(view){ if(view==='dashboard') renderDashboard(); if(view==='book') renderBooking(); if(view==='history') renderHistory(); if(view==='telehealth') renderTelehealth(); if(view==='support') renderSupport(); }

    // Dashboard
    function renderDashboard(){ contentTop.innerHTML = `<div class="cards"><div class="card"><h3>Upcoming Appointments</h3><div id='upcoming'></div></div><div class="card"><h3>Quick Actions</h3><div style='display:flex;flex-direction:column;gap:8px;margin-top:8px'><button id='newAppt' class='btn'>Book New Appointment</button><button id='openHistory' class='btn ghost'>Add Medical Note</button><button id='startCall' class='btn'>Start Telehealth Call</button></div></div></div>`;
      content.innerHTML = `<div class='card'><h3>Summary</h3><div style='display:flex;gap:12px;align-items:center;margin-top:12px'><div style='flex:1'><div class='muted'>Total appointments</div><div style='font-size:1.4rem;font-weight:800;margin-top:6px'>${appState.appointments.length}</div></div><div style='flex:1'><div class='muted'>History entries</div><div style='font-size:1.4rem;font-weight:800;margin-top:6px'>${appState.history.length}</div></div></div></div><div class='card mt-12'><h3>Appointments (latest)</h3><div id='apptList' class='appointments' style='margin-top:8px'></div></div>`;

      document.getElementById('newAppt').addEventListener('click', ()=> showView('book'));
      document.getElementById('openHistory').addEventListener('click', ()=> showView('history'));
      document.getElementById('startCall').addEventListener('click', ()=> showView('telehealth'));

      renderUpcoming(); renderApptList();
    }

    function renderUpcoming(){ const up = document.getElementById('upcoming'); up.innerHTML='';
      const next = appState.appointments.slice().sort((a,b)=> new Date(a.when)-new Date(b.when)).slice(0,3);
      if(next.length===0) up.innerHTML='<div class="muted">No upcoming appointments</div>';
      next.forEach(a=>{ const el = document.createElement('div'); el.className='appt'; el.innerHTML = `<div><div style='font-weight:700'>${a.doctorName}</div><div class='muted'>${new Date(a.when).toLocaleString()}</div></div><div><button class='btn ghost' data-id='${a.id}'>Cancel</button></div>`; up.appendChild(el); });
      up.querySelectorAll('button').forEach(b=>b.addEventListener('click', ()=>{ cancelAppointment(b.dataset.id); }));
    }

    function renderApptList(){ const list = document.getElementById('apptList'); list.innerHTML='';
      if(appState.appointments.length===0) list.innerHTML='<div class="muted">No appointments yet</div>';
      appState.appointments.slice().reverse().forEach(a=>{
        const el = document.createElement('div'); el.className='appt';
        el.innerHTML = `<div><div style='font-weight:700'>${a.doctorName}</div><div class='muted'>${new Date(a.when).toLocaleString()}</div><div style='margin-top:6px'>${a.reason}</div></div><div style='display:flex;flex-direction:column;gap:6px'><button class='btn' data-id='${a.id}'>Details</button><button class='btn ghost' data-cancel='${a.id}'>Cancel</button></div>`;
        list.appendChild(el);
      });
      list.querySelectorAll('button[data-id]').forEach(b=>b.addEventListener('click', ()=>{ alert('Appointment details:\n'+ JSON.stringify(appState.appointments.find(x=>x.id===b.dataset.id), null, 2)); }));
      list.querySelectorAll('button[data-cancel]').forEach(b=>b.addEventListener('click', ()=>{ cancelAppointment(b.dataset.cancel); }));
    }

    function cancelAppointment(id){ if(!confirm('Cancel appointment?')) return; appState.appointments = appState.appointments.filter(a=>a.id!==id); save(); renderDashboard(); }

    // Booking
    let preselectedDoctor = null;
    function preselectDoctor(id){ preselectedDoctor = id; }

    function renderBooking(){ contentTop.innerHTML = `<div class='card'><h3>Book a Quick Visit</h3></div>`;
      content.innerHTML = `<div class='card'><label class='field'>Select doctor</label><select id='doctorSelect'></select><div class='field'><label>Date & Time</label><input id='when' type='datetime-local'></div><div class='field'><label>Reason</label><input id='reason' placeholder='e.g., sore throat, check-up'></div><div style='margin-top:12px;display:flex;gap:8px'><button id='bookBtn' class='btn'>Book Appointment</button><button id='backDash' class='btn ghost'>Back</button></div></div>`;
      const sel = document.getElementById('doctorSelect'); DOCTORS.forEach(d=>{ const opt = document.createElement('option'); opt.value=d.id; opt.textContent = `${d.name} — ${d.specialty}`; sel.appendChild(opt); });
      if(preselectedDoctor) sel.value = preselectedDoctor; document.getElementById('backDash').addEventListener('click', ()=> showView('dashboard'));
      document.getElementById('bookBtn').addEventListener('click', ()=>{
        const did = sel.value; const when = document.getElementById('when').value; const reason = document.getElementById('reason').value.trim();
        if(!when || !reason){ alert('Please provide date/time and a brief reason'); return; }
        const doc = DOCTORS.find(d=>d.id===did);
        const appt = { id: uid(), doctorId: did, doctorName: doc.name, when, reason };
        appState.appointments.push(appt); save(); alert('Appointment booked'); showView('dashboard');
      });
    }

    // Medical History
    function renderHistory(){ contentTop.innerHTML = `<div class='card'><h3>Medical History</h3></div>`;
      content.innerHTML = `<div class='card'><label class='field'>Date</label><input id='histDate' type='date'><div class='field'><label>Notes</label><textarea id='histNotes' rows='3' placeholder='Symptoms, meds, diagnosis'></textarea></div><div style='margin-top:12px;display:flex;gap:8px'><button id='addHist' class='btn'>Add Entry</button><button id='exportJson' class='btn ghost'>Export JSON</button></div></div><div class='card' style='margin-top:12px'><h3>Entries</h3><div id='historyList' class='history-list' style='margin-top:8px'></div></div>`;

      document.getElementById('addHist').addEventListener('click', ()=>{
        const d = document.getElementById('histDate').value || new Date().toISOString().slice(0,10);
        const notes = document.getElementById('histNotes').value.trim();
        if(!notes){ alert('Please add some notes'); return; }
        appState.history.push({id: uid(), date: d, notes}); save(); renderHistory();
      });
      document.getElementById('exportJson').addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(appState.history, null, 2)], {type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='medical_history.json'; a.click(); });
      renderHistoryList();
    }

    function renderHistoryList(){ const node = document.getElementById('historyList'); node.innerHTML=''; if(appState.history.length===0) node.innerHTML='<div class="muted">No history entries</div>';
      appState.history.slice().reverse().forEach(h=>{ const el = document.createElement('div'); el.className='history-item'; el.innerHTML = `<div style='font-weight:700'>${h.date}</div><div class='muted' style='margin-top:6px'>${h.notes}</div><div style='margin-top:8px'><button class='btn ghost' data-id='${h.id}'>Delete</button></div>`; node.appendChild(el); });
      node.querySelectorAll('button[data-id]').forEach(b=>b.addEventListener('click', ()=>{ if(!confirm('Delete entry?')) return; appState.history = appState.history.filter(x=>x.id!==b.dataset.id); save(); renderHistory(); }));
    }

    // Telehealth: local webcam preview + simulated call
    let localStream = null;
    function renderTelehealth(){ contentTop.innerHTML = `<div class='card'><h3>Telehealth Call</h3></div>`;
      content.innerHTML = `<div class='card'><div style='display:flex;gap:12px;flex-direction:column'><label class='field'>Select doctor</label><select id='callDoc'></select><div style='display:flex;gap:8px'><button id='startCallBtn' class='btn'>Start Call</button><button id='endCallBtn' class='btn ghost'>End Call</button></div><div class='video-stage' style='margin-top:12px'><video id='remote' autoplay playsinline muted style='width:60%;height:320px;background:#111;border:1px solid rgba(255,255,255,0.03)'></video><video id='local' autoplay playsinline muted style='width:36%;height:180px;border:1px solid rgba(255,255,255,0.03)'></video></div></div></div>`;
      const sel = document.getElementById('callDoc'); DOCTORS.forEach(d=>{ const opt = document.createElement('option'); opt.value=d.id; opt.textContent = `${d.name} — ${d.specialty}`; sel.appendChild(opt); });
      document.getElementById('startCallBtn').addEventListener('click', async ()=>{
        try{
          const video = document.getElementById('local');
          localStream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
          video.srcObject = localStream;
          // simulate remote by cloning the same stream (in a real app remote stream arrives from peer)
          document.getElementById('remote').srcObject = localStream;
        }catch(err){ alert('Camera access failed: '+err.message); }
      });
      document.getElementById('endCallBtn').addEventListener('click', ()=>{ if(localStream){ localStream.getTracks().forEach(t=>t.stop()); localStream=null; document.getElementById('local').srcObject=null; document.getElementById('remote').srcObject=null; } });
    }

    // Symptom support: simple keyword matcher
    function renderSupport(){ contentTop.innerHTML = `<div class='card'><h3>Symptom Support</h3></div>`;
      content.innerHTML = `<div class='card'><label class='field'>Describe your symptoms</label><textarea id='symptoms' rows='3'></textarea><div style='margin-top:12px;display:flex;gap:8px'><button id='checkBtn' class='btn'>Get Advice</button><button id='askDoc' class='btn ghost'>Request Doctor</button></div><div id='advice' style='margin-top:12px'></div></div>`;
      document.getElementById('checkBtn').addEventListener('click', ()=>{
        const txt = document.getElementById('symptoms').value.toLowerCase(); if(!txt){ alert('Please describe symptoms'); return; }
        const adv = computeAdvice(txt); document.getElementById('advice').innerHTML = `<div class='advice'><strong>Advice:</strong><div style='margin-top:8px'>${adv}</div></div>`;
      });
      document.getElementById('askDoc').addEventListener('click', ()=>{ alert('A doctor will be notified (simulated). Please book an appointment for a real consult.'); });
    }

    function computeAdvice(text){
      if(/fever|temperature|chills/.test(text) && /cough|sore throat|breath/.test(text)){
        return 'You report fever + respiratory symptoms. For mild cases: rest, stay hydrated, monitor temperature. If breathing difficulty, persistent high fever, or chest pain, seek urgent care.';
      }
      if(/headache|migraine/.test(text) && !/fever/.test(text)){
        return 'Common headache — rest, hydrate, avoid screens, consider OTC analgesic per usual guidance. If severe or sudden onset, seek emergency care.';
      }
      if(/stomach|nausea|diarrhea/.test(text)){
        return 'Gut upset — hydrate with oral rehydration, avoid heavy meals, rest. If severe dehydration, bloody stools, or persistent vomiting, see a clinician.';
      }
      if(/anxiety|sad|depress|sleep/.test(text)){
        return 'Low mood or anxiety — try breathing exercises, scheduled routines, and consider reaching out to a mental health professional if symptoms persist. If you have urges of self-harm, call emergency services.';
      }
      return 'For mild symptoms: rest, hydrate, monitor. If symptoms worsen or you are unsure, book an appointment with a clinician.';
    }

    // Export history button
    document.getElementById('exportHistory').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(appState, null, 2)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'vhc_full_export.json'; a.click();
    });

    // Help
    document.getElementById('helpBtn').addEventListener('click', ()=>{
      alert('This is a local prototype. Book appointments, add medical notes, and start a simulated telehealth call (camera required). All data is stored in your browser only.');
    });

    // Simple CSV export for history
    function exportHistoryCSV(){
      const rows = [['id','date','notes']];
      appState.history.forEach(h=> rows.push([h.id,h.date,h.notes]));
      const csv = rows.map(r=>r.map(c=>`"${String(c||'')}"`).join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='medical_history.csv'; a.click();
    }

    // Preload
    load(); renderDoctors(); showView('dashboard');

    // Expose a few helpers for testing in console
    window.vhc = {state:appState, save, load, exportHistoryCSV};
  </script>
</body>
</html>
